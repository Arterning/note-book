InnoDB架构，一幅图秒懂！

原创 58沈剑  架构师之路  2019-10-15
网上写MySQL架构的文章比较多，写InnoDB架构的文章比较少，今天简单说说InnoDB架构。
画外音：一分钟，一幅图，秒懂。

MySQL简要架构是怎么样的？

MySQL整体分为三层：
（1）客户端，是各种编程语言的connector；
（2）MySQL服务，内部包含各种组件，实现各种功能；
（3）文件系统，数据存储与日志；

其中，MySQL服务内，可以以插件的形式，实现各种存储引擎。

在InnoDB，MyISAM，Memory…等各种存储引擎中，InnoDB是使用范围最广的。
画外音：事务，行锁，聚集索引，MVCC…众多特性让InnoDB备受青睐。

InnoDB简要架构是怎么样的？

InnoDB整体也分为三层：
（1）内存结构(In-Memory Structure)，这一层在MySQL服务进程内；
（2）OS Cache，这一层属于内核态内存；
（3）磁盘结构(On-Disk Structure)，这一层在文件系统上；

这三层的交互有两类：
（1）通过OS Cache落地数据（上图中，两个短箭头）；
（2）直接O_Direct落地数据（长途中，长箭头）；
画外音：这是一个性能与一致性折衷的设计。

InnoDB内存结构包含哪些核心组件？
InnoDB内存结构包含四大核心组件，分别是：
（1）缓冲池(Buffer Pool)；
（2）写缓冲(Change Buffer)；
（3）自适应哈希索引(Adaptive Hash Index)；
（4）日志缓冲(Log Buffer)；

恰好，这四大核心组件，今年都详细的写过。

缓冲池(Buffer Pool)
目的是提升InnoDB性能，加速读请求，避免每次数据访问都进行磁盘IO。
画外音：和系统架构设计中缓存的功能有点像，避免每次访问数据库。
这里面涉及的技术点包括：预读，局部性原理，LRU，预读失败+缓冲池污染，新生代老生代双链LRU…细节参见《缓冲池(buffer pool)，彻底懂了！》。

写缓冲(Change Buffer)
目的是提升InnoDB性能，加速写请求，避免每次写入都进行磁盘IO。
画外音：我C，这个牛逼，写入居然都可以不进行磁盘IO？
细节参见《写缓冲(change buffer)，彻底懂了！》，这篇文章的细节原理，特别有意思。

自适应哈希索引(Adaptive Hash Index)
目的是提升InnoDB性能，加速读请求，减少索引查询的寻路路径。
这里面涉及的技术点包括：聚集索引，普通索引，哈希索引…细节参见《InnoDB到底支不支持哈希索引》。

日志缓冲(Log Buffer)
目的是提升InnoDB性能，极大优化redo日志性能，并提供了高并发与强一致性的折衷方案。
这里面涉及的技术点包括：redo log作用，流程，三层架构，随机写优化为顺序写，次次写优化为批量写…细节参见《事务已提交，数据却丢了，赶紧检查下LogBuffer》。

InnoDB磁盘结构包含哪些核心组件？
主要包括日志与表空间，其结构与原理比InnoDB内存结构更加复杂，如果大家感兴趣，未来再撰文详述。


一分钟系列，希望大家对InnoDB架构，以及InnoDB内存结构的四大组件有了更系统性的了解。

知其然，知其所以然，希望大家有收获。

架构师之路-分享技术思路

相关文章：
《缓冲池(buffer pool)，彻底懂了！》
《写缓冲(change buffer)，彻底懂了！》
《InnoDB到底支不支持哈希索引？》
《事务已提交，数据却丢了，赶紧检查下LogBuffer》

末了，昨天有个朋友留言“谢谢”，说面试过程中，用从“架构师之路”里学到的知识，完美回答了面试官提出的一个MySQL底层细节问题，顺利拿到offer，涨薪20%。后来他和面试官一对，原来面试官也是看了架构师之路才学会的这个MySQL知识点，才问了相关的问题。

为啥说这个事？
我希望大家从“架构师之路”学到东西，职业生涯往上走，这是我的初衷。如果大家把学到的新知识，拿来出题为难面试者，这不是我想看到的，这样对没有订阅“架构师之路”的朋友不公平。

我承诺，不把从架构师之路中学到的新知识，作为面试候选人的面试题！

谢谢大家的支持！

58沈剑
能吃鸡腿么
钟意作者
10 人喜欢

阅读原文阅读 2.3万
 在看135

写下你的留言
精选留言

58沈剑
 57
 我承诺，不把从架构师之路中学到的新知识，作为面试候选人的面试题！
作者
 7
是时候转发，在看一波了！

孤星可
 21
 我承诺 不首先使用架构师之路
作者
 11
核武器？

空无
 13
 很赞同作者的看法，希望有些面试官们可以从实际出发，而不是找一些博客公众号里的技术细节来“刁难”面试者
作者
 7
额，我的文章也是能落地，从实际出发的，不是“学术派”。只是底层细节讲得多一些而已。

bEn
 3
 作为一名菜鸟工程师，看沈大的文章真的很有幸福感！
作者
 11
翻译一下：“别的文章很有深度（不容易懂），这边的文章比较容易（懂）”

雷少
 6
 我承诺，不把从架构师之路中学到的新知识，作为面试候选人的面试题！
作者
 4
替候选人感谢你！

张小超
 5
 我承诺，不把从架构师之路中学到的新知识，拿来为难面试官！

🍂 Yóung
 4
 这个画外音真是太帅了，我爱了

无痕
 3
 我承诺不首先使用架构师之路

阿辉
 1
 作者真的很用心了，彻底弄懂原理知识的同时还能从读者角度思考问题，努力把文章写的通俗易懂，想必也是费了特别大力气的，尤其是画外音，真的就是和我们读者站在一起了，为这个就要给作者点赞。
说一分钟看懂的文章，我一个一个看，加上思考和联想，用了一个小时才整个看完，干货满满，就是感觉有点标题党 ，哈哈（别打我）

%

 数据库索引覆盖， 索引下推，mvcc还是要用来面试别人的
作者
 1
原来就懂的知识，楼主没法评论。
从这儿学到的“新知识”，楼主建议不要拿来为难候选人。

枫
 1
 我承诺我要好好学架构师之路

frank

 你不提这个，我还不想说，沈老师，很多不是58公司的人总把你搬出来，把你的题当面试题，故意刁难58的同事，唉。
作者

对不起，我错了

henry

 强烈建议作者对mysql写的文章来一个汇总，如你之前做的缓存架构汇总https://mp.weixin.qq.com/s/4J3oM1j5hcLq4w4TdSEMPg 谢谢😀
作者

好
确实之前写得比较零散

Tale

 我承诺，学好架构师之路的知识后再去面试

HelloBobi

 言外之意..多看这个专栏万一吃亏了呢
作者

怎么会吃亏？

周治慧

 看了忘忘了在来看架构师之路学到很多
