阅读源码的三种境界

原创 刘欣  码农翻身  2018-03-15
"没有经验的技术差底子薄的初级程序员，如何阅读项目源码？ "

"有人阅读过 mybatis 的源码吗 ？就看一个初始化过程就看的已经头晕眼花了，小伙伴们支支招吧！"

"源码应该怎么阅读，我曾经尝试阅读一些源码，例如alibaba的druid中sqlparser部分，spring-mvc，但是发现很吃力，都说debug是最好的阅读方式，我在debug时经常有跟丢的现象……就是走着走着感觉好像进入了一些我当前不太关注细枝末节。 "
。。。。。。

估计很多人都有这样的疑惑。

我非常能理解小伙伴们的痛苦，因为我也是这么痛苦着走过来的。

阅读优秀源码的好处想必大家都知道，学习别人优秀的设计，合理的抽象，简洁的代码...... 总之是好处多多。

但是真的把庞大的代码放到你的面前，就如同一个巨大的迷宫，要在其中东转西转寻出一条路来，把迷宫的整个结构搞清楚，理解核心思想，真心不容易。

在阅读由面向对象的语言如Java写的代码时，会发现接口和具体的实现经常对应不起来，不太清楚一个功能到底是怎么在哪个实现类中才能找到。  不像C语言，就是函数调用函数，相对还好点。

如果是动态语言如Ruby,Python， 一个变量的类型甚至都不容易知道，阅读的难度大大增加。

还有一个重要的原因，现在我们看到的源码基本上都经过若干年发展、经过很多人不断地完善的，枝枝蔓蔓非常多，魔鬼都在细节中。  阅读的时候很容易陷进去， 看了几十层函数调用以后，就彻底懵了，就放弃了： 甭管你把源码吹得天花乱坠， 老子再也不看了。

经过很多痛苦的挣扎以后，我也算有一些成功的经历，今天用治学的三个境界来类比， 给大家分享一下：

昨夜西风凋碧树，独上高楼，望尽天涯路

想把源码搞懂，吃透，首先得登高望远，瞰察路径，明确目标与方向，了解源码的概貌。

所以有些准备工作必须得做。

1. 阅读源码之前，需要有一定的技术储备。
比如设计模式，在很多Java源码中几乎就是标配，尤其是这几个：模板方法，单例，观察者，工厂方法，代理，策略，装饰者。

再比如阅读Spring源码，肯定得先了解IoC是怎么回事，AOP的实现方式，CGLib，Java动态代理等，自己动手，写点相关的代码，把这些知识点掌握了。

2. 必须得会使用这个框架/类库， 最好是精通各种各样的用法。

上面刚提过，魔鬼都在细节中，如果有些用法根本不知道，可能你能看明白代码是什么意思，但是不知道它为什么这些写。

3. 先去找书，找资料，了解这个软件的整体设计。

都有哪些模块？ 模块之间是怎么关联的？怎么关联的？
可能一下子理解不了，但是要建立一个整体的概念，就像一个地图，防止你迷航。

在读源码的时候可以时不时看看自己在什么地方。

4. 搭建系统，把源代码跑起来！

相信我，Debug是非常非常重要的手段， 你想通过只看而不运行就把系统搞清楚，那是根本不可能的！

衣带渐宽终不悔，为伊消得人憔悴。

5. 根据你对系统的理解，设计几个主要的测试案例，定义好输入，输出。

运行系统，慢慢地debug ，一步步地走，这是个死功夫，没有办法绕过。

Debug一遍肯定是不行的，需要Debug很多遍。

第一遍尽可能抛弃细节，抓住主要流程， 比如有些看起来不重要的方法就不进去看了。

第二遍、第三遍....再去看那些细节。

一个非常重要的工作就是记笔记（又是写作！），画出系统的类图（不要依靠IDE给你生成的）， 记录下主要的函数调用， 方便后续查看。

文档工作极为重要，因为代码太复杂，人的大脑容量也有限，记不住所有的细节。 文档可以帮助你记住关键点， 到时候可以回想起来，迅速地接着往下看。

要不然，你今天看的，可能到明天就忘个差不多了。

给大家看看我做的一些笔记， 格式不重要，很随意，方便自己看懂就行。


6. 主要的测试案例搞明白了，丰富测试案例，考虑一些分支流程。
继续Debug......

总之，静态地看代码 + 动态地debug (从业务的角度)， 就会慢慢揭开这个黑暗森林的面纱。

这一步会非常非常地花费时间，但是你做完了，对系统的理解绝对有质的飞跃。

众里寻他千百度，蓦然回首，那人却在灯火阑珊处。

没有千百度的上下求索，不会有瞬间的顿悟和理解，衷心祝愿阅读源码的朋友们都能达到这一境界。

最后一点，也是最关键的一点： 要能坚持下去。

我不是一个聪明人， 但是笨人自有笨办法：什么事都架不住不断的重复，一遍看不明白，再来第二遍， 两遍搞不明白，再来第三遍......

可能有人要问： 你怎么能这么坚持地刨根问底呢？

答案就是好奇心： 这玩意儿到底是怎么实现的？！

分割线

欢迎加入我的知识星球“码农翻身”！

在那里我主要分享我是如何积累起现在的知识结构，学习过程的血和泪，职业发展的经验和教训，日常的所思所想，希望能帮助大家少走点儿弯路。

对于加入知识星球的同学提供特别的福利，即2017编程提高群第一季和第二季的部分“加餐”视频：

漫谈计算机组成原理和计算机编程语言
程序的机器级表示
漫谈操作系统之虚拟内存
进程和线程
新人在职场
Java并发编程
如何用Antlr实现自定义的简单脚本语言
缓存
BTree及其在数据库的应用
分布式文件系统FastDFS

阅读 3.2万
 在看13

写下你的留言
精选留言
 30
Only now

 老刘你这篇又没干货
 139
作者
 这还叫没有干货，这绝对是我的心血总结啊 。
 117
Y了个J

 我的境界就比较高，我称之为透过现象看本质，就是你以为我在看的是代码，实际我脑子里全是哲学"我是谁，我在哪，我要干嘛"
 51
passion

 我有两种方法，选一个代码的早期版本读或者从第一个commit开始读，可以看到代码的演变过程
 31
玛尔斯

 我的心得是:技巧方法固然重要，但核心思想是多花时间并且坚持下去。

阅读优秀的源码对程序员来说是一种享受，当你读到自己豁然开朗那一刻时，这种心情是无与伦比的。
 7
作者
 没错没错
 25
Baigio

 就想问一下，刘SIR你为什么这么牛，境界就是不一样。
 8
作者
 一点儿都不牛
 7
李奕慧

 画图用的啥
 17
作者
 visio
 12
Dylan

 原来我不是孤独的啊，很多人都觉得读源码很难啊，哈哈…
 11
Dark Army

 刚开始可以看原始版本
 9
Batman

 初级程序员还是多看看jdk源码比较好，那些框架无非就是封装jdk+设计模式
 9
董航

 好文，戳到了我的点
 5
林帅

 王国维的人生三境界？
 8
作者
 治学三境界
 6
Alearn

 感谢刘大的分享，我是一名大三学子。上学期我们学完了《设计模式》，这学期的课程设计便来了。老师给了两大类的题目，有分析题和设计题。分析题主要是研究别人的源码运用到的设计模式，在之前我选的是彭晨阳的JLive论坛，搞了几天云里雾里，一直看不清楚逻辑。小伙伴们说这个系统早已经过时了，于是放弃改研究其他的。可是这个问题就像我心中的梗一样，很不想放弃，今天看了刘大的知识分享，很受启发，还要继续死磕
 7
作者
 Jive中用了很多的设计模式，但是确实过时了，我建议你去看JUnit3.x版本。 大师的代码， 也用到了很多设计模式
 7
jc

 我特别喜欢看两个: 接口实现层次，和调用堆栈。
 6
🇨🇳🇨🇳夏🌞

 你的文章真的是大爱，完了，爱上你了，咋办
 5
作者
 加个好友先
 3
Pluto

 我看了还是不懂？源码怎么运行啊？写一个demo吗？下过spring的源码，没有找到可执行函数的，还是我打开方式不对？求指教
 6
作者
 这就说明你还不会使用spring ， 没法让spring跑起来，先把这一课补上吧。
 2
AlexPeng

 好文好文，画图画的那么详细精美绝对是用了心的，你觉得是用visio画的吗？
 6
作者
 为了把关系理清楚，不知不觉图就画成那样了，很费时间的。 用的visio。
 6
0x55AA

 阅读源代码，要带有很强的目的性，就是文章最后说的，这玩意儿到底是怎么实现的。但在这之前，开源的组件，还是得先用熟了才行，使用过程中思考是怎么实现的，这样才能更专注于阅读代码的目的，不要为了看而看，不然狠容易迷失在代码中。
 2


 我也觉着你没干活！太闲了！还有时间发博文。
 5
作者
 最近忙，推文很少了，每周只剩两篇了，忘大家伙多多包涵
 2
理想

 一直在找一个笔记图方便的软件，刘sir，能推荐一下吗🌝
 5
作者
 我就是非常原始的visio +word
 5
阮铁林

 这个相当干货，可能是抽象程度高了
 4
四季豆

 我还在三界之外，莫非跟孙悟空身份一样
 4
Killbug

 “这玩意儿到底是怎么实现的？！”
 4
不息

 最近才看完别人的代码，感觉很切合啊。虽然不是太大型的源码。但是笔记，类图，调用关系真的很重要
 3
Amy

 最新我在读一个很复杂的系统的代码，也像你那样画图的，好巧哦
 3
作者
 2
hugo

 老刘，对于刚学的初学者我来说看源码就是噩梦啊
 3
作者
 有经验了重新来过
 3
zeus

 以本人15年的经历真心的赞同，一如源码深似海，从此再无回头路。换句话说，源码看不懂，一辈子都是个底层码农。
 3
su

 有用有用，最近看代码学东西总有模模糊糊的感觉，应该怎么更高效，结果刘大给总结出来了，就是这个，很清晰
 3
Sol

 好熟悉的，王国维人间词话
 3
KING

 抓住核心结构，抓住主流程，再看细节。其实就按照自己开发系统流程类似吧
 3
魏振方🍒

 设计模式+语言基础+真.思考时间
 3
麟渊

 缺一个强大的思维导图制作软件。
 2
瞿小渣

 单纯的手工测试不行了，需要往性能测试，自动化测试复合型发展了，所以多懂些代码肯定是好的吧😀
 2
作者
 没错，需要测试人员写代码了
 2
gc

 实现ArrayList都搞了半天，我得啥时候到你的境界
 2
作者
 很快的
 2
zmant

 厉害，问一下那两个图怎么画的
 2
作者
 我常用visio
 2
taylor

 文章非常赞！学习了。
唯独不赞同「我不是聪明人」，程序员怎么可能不适聪明人
 2
作者
 普通人
 2
张永超

 为什么我感觉我之前看过这篇文章啊？
 1
作者
 嗯？
 2
Leo

 什么是源码
 1
作者
 2
英姿勃发

 要是十年前看到这篇文章就好了，也不用走那么多的弯路。
 2
冬

 膜拜刘大，向你学习
 2
刘庆文

 老刘～代码界的文学士！
 2
胡金海

 写的非常好，谢谢分享。
 2
会

 感觉收益匪浅，有同感
 2
搏未来

 我在第0层
 2
Lizhiqiang

 谢谢休息休息
 2
长颈鹿27

 刘老师又出好文章了，赞～
 2
h

 坐等刘老师新书啊，因为我爱看纸质版的书
 2
舒明

 老刘最后说的很对，好奇心很重要，好奇心是支持走进去的原动力之一～
 2
王路遥

 源码，主要读源码的时间都是在找bug
 2
Kingdom

 路漫漫其修远兮，吾将上下而求索
 2
三金

 写的都是满满的真心话，赞一个！
 2
LeonXi

 阅读源码，其实给煲洋葱一样，先看架构图，有个大概，在看时序图，然后在一点点，断点分析和总结。确实和老刘说的一样，需要非常多的基础知识。
 2
高兵

 一入IT深似海，刘老师就是灯塔。从你的文章中学到了很多理解了很多，非常感谢
 2
沿途有你

 王国维，人生三种境界
 2
晨起临风

 授人以渔
 2
豆豆

 到底是咋实现的
 2
司马无功

 刘刘刘溜溜溜666
 2
独顽且鄙

 ut写得好的源码 比较容易阅读
 2
丶

 大佬带我飞
 2
得法

 一个字 啃，死去活来的过程，见多了就不怪了，测试用例，还是测试用例。
 2
whisper

 其实应该先从test case 入手，开源项目的test case还是挺全的
 2
利锋

 方式太好了，以后也要这么折磨自己
 2
闫志刚

 如果注释好，什么都好。
 1
黃小梦

 看完立即点了收藏
 1
作者
 也要多转发啊
 1
小伞

 老刘，你堕落了
 1
作者
 此话怎讲？
 1
风

 第五步的图是vison画的吗
 1
作者
 是的

A

 我们公司的代码都是一些祖传代码，很纠结要不是通读一下
 1
作者
 先理清模块之间的关系
 1
return you;

 谢谢
 1
牙亏~

 读的最多的是单片机程序,全程看手册,真恶心
 1
平头哥，我们走

 绝对的干货，想当年我看公司框架时，也是拿个本子记，记一些公司开头命名的类，一点点走，一点一点看！
 1
Wu, J

 这两天就在读一种新协议的实现代码，文章写得很好，今天继续debug
 1
曾子曰:

 嗯，跟着大神走一走，然后吃完早餐睡觉
