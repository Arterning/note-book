C语言这么厉害，它自身又是用什么语言写的？

原创 码农翻身刘欣  码农翻身  2019-09-27
 这是来自我的星球的一个提问：“C语言本身用什么语言写的？”

换个角度来问，其实是：C语言在运行之前，得编译才行，那C语言的编译器从哪里来？ 用什么语言来写的？如果是用C语言本身来写的，到底是先有蛋还是先有鸡？


1


我们假设世界上不存在任何编译器， 先从机器语言说起，看看怎么办。

机器语言可以直接被CPU执行，不需要编译器。

然后是汇编语言， 汇编语言虽然只是机器语言的助记符，但是也需要编译成机器语言才能执行，没办法只能用机器语言来写这第一个编译器了（以后就不用了）。

汇编语言的问题解决了，就往前迈进了一大步，这时候就可以用汇编语言去写C语言的编译器，我们说这是C编译器的老祖宗。

有了这个老祖宗，就可以编译任意的C语言程序了，那是不是可以用C语言本身写一个编译器？只要用老祖宗编译一下就可以了。

OK， 这么一层层上来，终于得到了一个用C语言写的编译器， 真是够麻烦的。

到这个时候，之前那个汇编写的C语言编译器就可以抛弃了。

当然，如果在C语言之前，已经出现了别的高级语言，例如Pascal，那就可以用Pascal来写一个C语言的编译器。

第一个Pascal的编译器据说使用Fortran写的。而做为第一个高级语言的Fortran，它的编译器应该是汇编语言写的。


2


关于编译器，这里边有个有趣的传说：

传说Unix 发明人之一的 Ken Thompson在贝尔实验室，大摇大摆的走到任何一台Unix机器前，输入自己的用户名和密码，就能以root的方式登录！

贝尔实验室人才济济，另外一些大牛发誓要把这个漏洞找出来，他们通读了Unix的C源码，终于找到了登录的后门， 清理后门以后编译Unix , 运行， 可是Thompson 还是能够登录进去。

有人觉得可能是编译器中有问题，在编译Unix的时候植入了后门， 于是他们又用C语言重新写了一个编译器，用新的编译器再次编译了Unix， 这下总算天下太平了吧。

可是仍然不管用， Thompson 依然可以用root登录，真是让人崩溃 ！

后来Thompson 本人解开了秘密，是第一个C 语言编译器有问题， 这个编译器在编译Unix源码的时候，当然会植入后门， 这还不够，更牛的是，如果你用C 语言写了一个新编译器，肯定也需要编译成二进制代码啊，用什么来编译，只有用Thompson写的那第一个编译器来编译，好了， 你写的这个编译器就会被污染了，你的编译器再去编译Unix , 也会植入后门 :-)

说到这里我就想起了几年前的XcodeGhost 事件，简单来说就是在Xcode（非官方渠道下载的）中植入了木马，这样XCode编译出的ios app都被污染了，这些app就可以被黑客利用做非法之事。

虽然这个XCodeGhost和Thompson的后面相比差得远，但是提醒我们，下载软件的时候要走正规渠道，从官方网站下载，认准网站的HTTPS标准，甚至可以验证一下checksum。


3


可能有人问：我用汇编写一段Hello World都很麻烦，居然有人可以用它写复杂的编译器？这可能吗？

当然可能，在开发第一代Unix的时候，连C语言都没有， Ken Thompson 和 Dennis Ritchie 可是用汇编一行行把Unix敲出来的。   WPS第一版是求伯君用汇编写出来的， Turbo Pascal 的编译器也是Anders 用汇编写出来的，大神们的能力不是普通人能想象得到的。

对于编译器来说，还可以采用“滚雪球”的方式来开发：

还是以C语言为例，第一个版本可以先选择C语言的一个子集，例如只支持基本的数据类型，流程控制语句，函数调用...... 我们把这个子集称为C0。

然后用汇编语言写个编译器，只搞定这个语言的子集C0，这样写起来就容易不少。

C0这个语言可以工作了，然后我们扩展这个子集，例如添加struct，指针......  ，把新的语言称为C1。

那C1这个语言的编译器由谁来写？   自然是C0。

等到C1可以工作了，再次扩展语言特性，用C1写编译器，得到C2。

然后是C3, C4......  最后得到完整的C语言。

这个过程被称为bootstraping ， 中文叫做自举。

END

我是刘欣，畅销书《码农翻身》作者，15年以上开发经验，前 IBM 架构师，领导过多个企业应用架构设计和开发工作；洞察技术本质，擅长用故事去讲解复杂技术。

每天仅需4毛钱， 加入码农翻身知识星球，和我以及来自腾讯、阿里、京东、滴滴、IBM、SAP等各路大牛深度交流技术学习，项目开发，编程技术，职业发展......


阅读 2.8万
 在看141

写下你的留言
精选留言
 146
欣

 创世大神耍赖，群神束手无策
 134
加奶不加糖

 道(硬件)生一(机器码)，一生二(汇编)，二生三(C语言)，三生万物
 58
jyl

 然后，机器语言也不能直接被识别，需要翻译成高低电压......
 49
海德曼

 古人云：勇者不能自举其身。可是大神们厉害，让java, go,rust一个个都自举了。码农就辛苦了，一个个学得都快不举了⋯⋯
 10
作者
 13
海人

 为什么计算机可以识别机器语言。。。
 45
作者
 强烈推荐《编码》这本书，能打通 硬件和软件 之间这道墙。   我本来想在这里留言中说一下，发现有字数限制， 主要还是自身理解的不透彻，没法通俗易懂地讲， 容我想想......
 32
SendMessage

 左脚踩右脚，右脚再踩左脚，左脚再踩右脚持续的swap…，就能上天了
 22
dave

 再然后，人们根据业务场景又开发了C10、C100、C1000、C...，PHP只是Cn，所以并不能说PHP是世界上最好的语言？
 12
我不口渴

 沙发？
看来是先有蛋再有鸡 (〃'▽'〃)
 11
没有好使的磨棍

 从入行开始，这个问题困扰了我很久，有一次做梦，醒来就想通了（其实就是自己编造了一个答案）。直到后来才明白，当初自己给自己编的那个答案居然是正确的。
 4
杨俊明

 那么问题来了，汇编语言又是如何写出来的？
 9
作者
 机器语言
 8
喜闻乐见

 哈哈哈哈那个传说笑死我了
 6
Fantasy饭特稀

 那么问题来了，用C语言写个JAVA，然后用JAVA写个C编译器，还会被C0污染吗
 7
作者
 KenThompson 在Google创造了Go，现在Go语言也可以自举，不知道.....  
 4
0x55AA

 看标题就知道是自举，git的源代码也是用git管理的，也是自举
 7
作者
  专门写过一篇叫  全球最大同性交友网站的黑历史
 7
十八画生

 当然是用只存在传说中的X语言写的
 4
ibin

 go也能自举
 4
作者
 对，go也实现自举了， java也是
 2
O_o

 这个怎么讲？真没接触过自举的东西，能举了栗子吗，难道windows在dos上自举？
 4
作者
 不是，讲得是怎么一步步把操作系统给启动起来， 我琢磨下也写个文章。
 4
乌尔班羊

 看到前人的留言，我猜现在不少程序员从业者没学过操作系统和汇编语言。猜对的给我点赞，呵呵。
 1
O_o

 这是说在编译器领域，在其他领域有没有自举的应用，比如机器学习
 3
作者
 操作系统也是自举的啊
 3
jb

 最起码在1970年代，甚至到1980年代前半，写汇编语言还是很重要的能力。

当时内存很贵很少。还有很多很多连64 KB内存都没装满的8-bit机器。要写比较复杂的功能，要确保执行速度，就要用可以接受的最低阶语言自己人工写码，人工优化。

Apple II时代大多数绘图游戏是用汇编语言写的。还有很多人连LISA Assembler都没有，要自己写机器码。6502有很多定址模式，用汇编语言写LDA只要注明定址模式就可以。用手工编译成机器码要自己记住最多八个定址的码（$A9, $A5, $B5……）。如果是相对位址还要自己计算16进位，零页指令还要记得不要占用系统拿去用的位址。

当时有很多高阶语言。但是编译器不可能给你优化。甚至为了加速计算，浮点数太慢，还要根据自己的需求发明非标准的“定点数”。

另外有些新硬件的语言是在旧硬件上编译的。在设计Apple III, IBM PC, Lisa, Macintosh 128k的时候，很多软件要用以前的机器开发。
 3
淍

 感觉像物种的演进
 3
hobin

 c0解析c1代码，c1解析c2代码，一环套一环呀
 3
red and black

 语言进化史
 3
麦哲伦

 以前也考虑过这个问题
 1
yoohohoho

 所以语言编译器是把源语言编译成目标语言对吗？
那是不是意味着我可以用高级语言写一个系统层语言编译器？
 2
作者
 是的 没问题的
 2
Mr.Xie

 “强烈推荐《编码》这本书，能打通 硬件和软件 之间这道墙。   我本来想在这里留言中说一下，发现有字数限制， 主要还是自身理解的不透彻，没法通俗易懂地讲， 容我想想......”      坐等
 1
作者
 看来我得加油了
 2
浪里白条

 那X语言的编译器要用什么语言来写呢
 1
作者
 这个得问问AI
 2
彦彬

 C语言靠什么，靠Cxx,Cxx靠什么，靠Cxx-1,循环到C0,C语言就出来了

 2
水

 我想起来那个神奇的词语pypypypy
 2
蚂蚁

 让我想起来Google大神Jeff Dean的编译器笑话
 2
leslie

 先有鸡还是先有蛋这是问题么， 咱们可以借鸡生蛋
 2
春爬村上树

 世界上第一只鸡怎么来的？
 2
梦想启动的蜗牛

 2
Cliff

 很棒呦
 1
装作找不见 各自奔前程

 其实有一个更让人感兴趣的题目，就是从一堆硬件出发（处理器、内存条、主板、键盘、显示器、外设），怎么在连汇编编辑器也没有的情况下在一块黑显示屏（默认输出）上打出一句“hello world.”

国内的计算机发展历程错过太多了，二极管、三极管、磁带打孔、低级语言、高级语言，计算机教育因为缺了这一大块造成一个巨大的破洞。
 1
王冠

 python也可以自举，Python写的Python解释器
 1
狸猫吐口水จุ๊บ

 我抓狂的lisp不服，万物皆lisp！
 1
Mínghào胡明皓Hú

 现在C的编译器都是C++写的。
 1
🐭生活是一场持续的搏斗

 自举呗？不举……
