见过的最垃圾的代码，是怎么样的？

芋道源码  2019-12-26
点击上方“芋道源码”，选择“设为星标”
做积极的人，而不是积极废人！
源码精品专栏

原创 | Java 2019 超神之路，很肝~
中文详细注释的开源项目
RPC 框架 Dubbo 源码解析
网络应用框架 Netty 源码解析
消息中间件 RocketMQ 源码解析
数据库中间件 Sharding-JDBC 和 MyCAT 源码解析
作业调度中间件 Elastic-Job 源码解析
分布式事务中间件 TCC-Transaction 源码解析
Eureka 和 Hystrix 源码解析
Java 并发源码
来源：OSCHINA
某网友在 Hacker News 上发起了一个 “你见过的最糟糕的代码是什么？ ” 的问题，引起了广泛关注和讨论，评论数已接近600条。

其中，一位 ID 为“oraguy”的程序员对 Oracle 数据库代码的吐槽，更是引发热议。内容大意如下：

Oracle 数据库 12.2，它有近 2500 万行 C 代码。

这有多恐怖，简直难以想象！你无法在不破坏成千上万个现有测试的情况下更改产品中的单行代码。好几代程序员在有限的项目期限内编写了这些代码，其中充斥着大量的垃圾代码。

非常复杂的逻辑、内存管理、上下文切换等，这些都用数千个 flag 连接起来。整个代码充斥着神秘的宏命令，如果不拿出笔记本，并且手动去展开相关的宏命令，就无法理清楚这些命令。甚至可能需要一两天才能真正理解某个宏命令的作用。

有时你需要理顺 20 个不同 flag 的值和效果来预测代码在不同情况下的行为方式。有时多达数百个 flag ！这一点也不夸张。

这个产品仍然存活并且仍然可用的唯一原因是数百万次的测试！

以下是 Oracle 数据库开发人员的日常：

开始处理一个新的 bug 。
花两周的时间试图理解 20 个不同的 flag ，这些 flag 以神秘的方式相互交互，导致这个困境。
再添加一个 flag 来处理新的特殊场景。添加几行代码来检查此 flag ，并解决有问题的情况，规避该 bug 。
将更改提交到包含大约100-200台服务器的测试服务器集群，这些服务器将编译代码，构建新的 Oracle 数据库，并以分布式方式运行数百万个测试。
回家。第二天来上班，继续处理别的 bug 。测试可能需要20-30个小时才能完成。
再回家。再来上班，检查你的集群测试结果。顺利的话，会有大约100个失败的测试。倒霉的话，将有大约1000个失败的测试。随机选择一些测试并试图搞清楚你的假设出了什么问题。或许还需要考虑10多个 flag 才能真正理解 bug 的本质。
再添加一些 flag 以尝试解决问题。再次提交更改以进行测试。再等20-30个小时。
来来回回重复两周，直到你得到了将这些 flag 组合起来的“神秘咒语”。
终有一天，你会成功，不再出现测试失败。
为你的新更改添加100多个测试，以确保下一个不幸接触这段新代码的开发人员永远不会破坏你的修复。
提交最后一轮测试的成果。然后提交以供审核。审查本身可能还需要2周到2个月。所以接下来继续去处理下一个 bug 。
在2周到2个月之后，一切已就绪，代码将最终合并到主分支中。
以上就是对在 Oracle 修复 bug 的程序员日常生活的描述，一点也不夸张。现在想象一下开发新功能会有多么恐怖。

开发一个小功能需要6个月到1年的时间（如果是添加一种新的身份验证模式，比如支持 AD 身份验证，可能需要2年）。

这款产品本身就是一个奇迹！

我不再为 Oracle 工作了，永远不会再为 Oracle 工作了！


欢迎加入我的知识星球，一起探讨架构，交流源码。加入方式，长按下方二维码噢：


已在知识星球更新源码解析如下：




最近更新《芋道 SpringBoot 2.X 入门》系列，已经 20 余篇，覆盖了 MyBatis、Redis、MongoDB、Elasticsearch、分库分表、读写分离、SpringMVC、SpringWebflux、WebSocket、Dubbo、RocketMQ、Kafka、性能测试等等内容。
提供近 2W 行代码的 SpringBoot 示例，以及超 4W 行代码的电商微服务项目。
获取方式：点“在看”，关注公众号并回复 666 领取，更多内容陆续奉上。

如果你喜欢这篇文章，喜欢，转发。
生活很美好，明天见(｡･ω･｡)ﾉ♡
阅读原文阅读 7089
 在看23

写下你的留言
精选留言
 2
GLUTTONY

 自己5年前的代码..
 11
作者
 不是三个月前么
 11
wayne

 最垃圾的代码在谭浩强的书上
 1
作者
 哈哈哈(ಡωಡ)hiahiahia
我们看的同一套教材
 3
太美好

 还在用过Oracle，每次看见别人写的各种包就头大，公司里他们的业务逻辑全部写在包里，美其名曰“这样直接操作数据库，效率比较高”。我不写包但是有时候要调试他们的包，进去一个简单的flag是视图套视图，包调包处理的结果，理解一个flag我就得花老半天，真真的头大。工作中还没用过MySQL，我感觉这和开发习惯关系更大吧，喜欢写包的人用MySQL照样还是无数包无数flag。

作者
 心疼，我差点也进了类似公司，在实习的时候。
