
![[Pasted image 20240327113205.png]]


第一阶段是表决阶段，所有参与者都将本事务能否成功的信息反馈发给协调者；

第二阶段是执行阶段，协调者根据所有参与者的反馈，通知所有参与者，步调一致地在所有分支上提交或者回滚。


两阶段提交方案应用非常广泛，典型商用软件包括Oracle Tuxedo和IBM CICS。它的优点是对业务代码侵入较低，但缺点也很明显：

**性能低下**：由于 XA 协议自身的特点，它会造成事务资源长时间得不到释放，锁定周期长，而且在应用层上面无法干预，数据并发冲突高的场景性能很差。

**单点问题**：协调者在整个两阶段提交过程中扮演着举足轻重的作用，一旦协调者所在服务器宕机，就会影响整个数据库集群的正常运行。比如在第二阶段中，如果协调者因为故障不能正常发送事务提交或回滚通知，那么参与者们将一直处于阻塞状态。

**同步阻塞**：两阶段提交执行过程中，所有的参与者都需要听从协调者的统一调度，期间处于阻塞状态而不能从事其他操作，效率及其低下。

因此，两阶段提交方案在互联网业务中很少使用，无法满足高并发需求。

为了这个弥补这种方案带来性能低的问题，大家又想出了很多种方案来解决，通过在应用层做文章，即入侵业务的方式，比较典型的是TCC 方案和基于可靠消息的最终一致性方案。






不管我们选哪一种方案，在项目中应用都要谨慎再谨慎，除特定的数据强一致性场景外，能不用尽量就不要用，因为无论它们性能如何优越，一旦项目套上分布式事务，整体效率会几倍的下降，在高并发情况下弊端尤为明显。