
## IP hash 负载均衡

![[Pasted image 20240401140234.png]]



```
hash(ip) % node_counts = index
```


当我们使用进程内缓存的时候，可以通过这张方式实现粘性session



还有另外一种方式，也就是分布式session


### **分布式 session**

session 是把状态数据保存在服务端，那么问题来了，如果有多台服务器呢？

当并发量上去了，单台服务器根本承受不了，自然需要做集群，也就需要多台服务器来提供服务。

而且现在后端还会把不同的功能拆分到不同的服务中，也就是微服务架构，自然也需要多台服务器。

那不同服务器之间的 session 怎么同步？


登录之后 session 是保存在某一台服务器的，之后可能会访问到别的服务器，这时候那台服务器是没有对应的 session 的，就没法完成对应的功能。

这个问题的解决有两种方案：

一种是 session 复制，也就是通过一种机制在各台机器自动复制 session，并且每次修改都同步下。这个有对应的框架来做，比如 java 的 spring-session。

各台服务器都做了 session 复制了，那你访问任何一台都能找到对应的 session。

还有一种方案是把 session 保存在 redis，这样每台服务器都去那里查，只要一台服务器登录了，其他的服务器也就能查到 session，这样就不需要复制了。

