
#### 常见的监控对象和指标都有哪些？

应用系统的监控主要分为指标监控和日志监控两大部分：

- 指标监控主要是对一定时间段内性能指标进行测量，然后再通过时间序列的方式，进行处理、存储和告警。
- 日志监控则可以提供更详细的上下文信息，通常通过 ELK 技术栈来进行收集、索引和图形化展示。

指标监控可以说是系统监控最核心的功能。主要有服务器资源、应用监控、数据库中间件等。

- 服务器资源监控：CPU使用率、内存使用率、磁盘使用率、磁盘读写的吞吐量、网络出入流量等等。
- 数据库监控：TPS、QPS、数据库连接数、慢SQL、InnoDB缓冲池命中率等。
- Redis监控：内存使用率、缓存命中率、key值总数、Redis响应请求时间、客户端连接数、持久性指标等。
- MQ消息监控：连接数、队列数、生产速率、消费速率、消息堆积量等等。
- 应用监控：包括HTTP请求，JVM，线程池等。




#### 监控系统的架构

一个完整的监控系统通常由数据采集、数据传输、数据存储、数据展示、监控告警等多个模块组成。

- 数据采集，采集的方式有很多种，包括日志埋点进行采集，JMX标准接口输出监控指标，被监控对象提供REST API进行数据采集（如Hadoop、ES），系统命令行，统一的SDK进行侵入式的埋点和上报等。
- 数据传输，将采集的数据以TCP、UDP或者HTTP协议的形式上报给监控系统，有主动Push模式，也有被动Pull模式。
- 数据存储，有使用MySQL、Oracle等关系数据库存储的，也有使用时序数据库RRDTool、OpentTSDB、InfluxDB存储的，还有使用HBase存储的。
- 数据展示，数据指标的图形化展示。
- 监控告警，灵活的告警设置，以及支持邮件、短信、IM等多种通知通道。


![[Pasted image 20240323102924.png]]


Prometheus 用的是Pull 方式


应用安装exporter 导出监控数据，提供metrics API

Prometheus 配置一下metrics_path 就行，告诉他从哪个api endpoint 读取监控数据


## Prometheus常用的时序指标


.Prometheus客户端中提供4种指标类型，但是Prometheus的服务端并不区分指标类型，而是简单地把这些指标统一视为无类型的时间序列。

- Counter: 计数器表示一种单调递增的指标，除非发生重置的情况下下只增不减，其样本值应该是不断增大的。适合用来表示服务的请求数、已完成的任务数、错误发生的次数等
    
- Gauge: 仪表盘类型代表一种样本数据可以任意变化的指标，即可增可减。通常用于表示温度或者内存使用率这种指标数据。
    
- Histogram:直方图主要用于表示一段时间范围内对数据进行采样，（通常是请求持续时间或响应大小），并能够对其指定区间以及总数进行统计。Histogram指标直接反应了在不同区间内样本的个数

- Summary:Summary 和 Histogram 类似,但Summary类型是在客户端直接聚合生成的百分位数






面试案例：

可以讲讲如何用Prometheus监控JVM堆内存。




























