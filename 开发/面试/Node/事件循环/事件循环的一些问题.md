
nodejs中的poll是epoll轮询 那为什么程序执行完之后还是会退出呢？不应该一直轮询吗

答案：不是的，事件循环也有退出机制。

检查其他线程里是否还有待处理事项
- 检查其他任务是否还在进行中（比如计时器、文件读取操作等任务是否完成）
-  有以上情况，进入事件循环，运行其他任务  

- 由于node线程一直holding在poll队列，等很长一段时间还是没有任务来临时，会自动断开等待（不自信表现），向下执行轮询流程，经过check、close callbacks后到达event loop
- 到了event loop后，检查是否有异步任务，检查发现有请求任务。（此时定时器任务已经执行完毕，所以没有了），则继续再次进入事件循环。
- 到达poll队列，再次holding……
- 再等很长时间没有任务来临，自动断开到even loop（再补充一点无任务的循环情况）
- 再次回到poll队列挂起
- 无限循环……直到event loop也不需要进入为止（其他线程和任务都已经处理完毕）

  


假如我写一个node.js脚本，从IO读取一个文件，如果IO响应很慢或者文件很大，有无可能文件还没读取完，主程序就已经结束了？

不会的，因为我们需要检查是否需要进入事件循环
假如第一次循环并没有收到文件已经返回的事件，第二次就会再次进入事件循环。
第二次就会检查是否有文件读取任务没有完成，如果没有完成，那么需要再次进入事件循环！

- `main`：启动入口文件，运行主函数
- `event loop`：检查是否要进入事件循环
    - 检查其他线程里是否还有待处理事项
    - 检查其他任务是否还在进行中（比如计时器、文件读取操作等任务是否完成）
    - 有以上情况，进入事件循环，运行其他任务  
        事件循环的过程：沿着从timers到close callbacks这个流程，走一圈。到event loop看是否结束，没结束再走一圈。
- `over`：所有的事情都完毕，结束

  