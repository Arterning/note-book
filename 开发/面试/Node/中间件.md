![[Pasted image 20240309093916.png]]

- 上面是在网上找的一个示意图，就是说中间件执行就像洋葱一样，最早 use 的中间件，就放在最外层。处理顺序从左到右，左边接收一个 request，右边输出返回 response
    
- 一般的中间件都会执行两次，调用 next 之前为第一次，调用 next 时把控制传递给下游的下一个中间件。当下游不再有中间件或者没有执行 next 函数时，就将依次恢复上游中间件的行为，让上游中间件执行 next 之后的代码
    
- 例如下面这段代码

```js
const Koa = require('koa')
const app = new Koa()
app.use((ctx, next) => {
    console.log(1)
    next()
    console.log(3)
})
app.use((ctx) => {
    console.log(2)
})
app.listen(3001)


执行结果是1=>2=>3

```

https://mp.weixin.qq.com/s/YoMLuL5AhLTMMlwP4wqSSw